@page "/minhareserva/{ReservationId}"
@using System.Globalization
@inject NavigationManager navigationManager
@inject APICloudbeds cloudbedsAPI

@rendermode InteractiveAuto

<PageTitle>Reserva</PageTitle>


@if (reserva is null)
{
    <MudPaper Class="px-8 pt-2 mx-4 my-4 rounded-xl" Align="Align.Center" Justify="Justify.Center">
        <MudGrid Justify="Justify.Center" Class="align-items-center">
            <MudItem>
                <MudProgressCircular Indeterminate="true"></MudProgressCircular>
            </MudItem>
        </MudGrid>
    </MudPaper>
}
else
{
    <MudContainer Class="px-8 pt-2 mx-4 my-4" MaxWidth="MaxWidth.False">
        <MudGrid>
            <MudItem xs="12" sm="6">
                <MudPaper Elevation="2" Class="pa-4  rounded-xl" Style="height: 100%">
                    <MudGrid Justify="Justify.Center" Class="align-items-center">
                        <MudItem>
                            <MudText Typo="Typo.h3" Align="Align.Center" Color="Color.Success"> <i class="fa fa-check" aria-hidden="true"></i> </MudText>
                        </MudItem>
                    </MudGrid>
                    <MudText Typo="Typo.h6" Align="Align.Center" GutterBottom="true">Agradecemos seu pedido!</MudText>
                    <MudText Align="Align.Center"> O número da reserva é #@reserva.IDReserva  </MudText>
                    <MudText Align="Align.Center"> Enviamos a confirmação do pedido para o e-mail: @reserva.Email  </MudText>
                    <MudGrid Justify="Justify.Center">
                        <MudItem xs="3">
                            <MudGrid Class="align-items-center">
                                <MudItem>
                                    <MudText Align="Align.Center"> Check-in </MudText>
                                    <MudText Typo="Typo.h6" Align="Align.Center" Color="Color.Success">  @reserva.DataCheckIn.GetValueOrDefault().ToString("dd/MM/yyyy")</MudText>
                                    <MudText Align="Align.Center">@reserva.DataCheckIn.GetValueOrDefault().ToString("dddd", new CultureInfo("pt-BR"))</MudText>
                                </MudItem>
                            </MudGrid>
                        </MudItem>
                        <MudItem xs="1">
                            <MudGrid Justify="Justify.Center" Class="d-flex flex-1 align-items-center">
                                <MudItem>
                                    <i class="fa fa-arrow-right" aria-hidden="true"></i>
                                </MudItem>
                            </MudGrid>
                        </MudItem>
                        <MudItem xs="3">
                            <MudGrid Class="align-items-center">
                                <MudItem>
                                    <MudText Align="Align.Center">Check-Out </MudText>
                                    <MudText Typo="Typo.h6" Align="Align.Center" Color="Color.Success"> @reserva.DataCheckOut.GetValueOrDefault().ToString("dd/MM/yyyy") </MudText>
                                    <MudText Align="Align.Center">@reserva.DataCheckOut.GetValueOrDefault().ToString("dddd", new CultureInfo("pt-BR")) </MudText>
                                </MudItem>
                            </MudGrid>
                        </MudItem>
                    </MudGrid>
                    <MudText Align="Align.Center">
                        <i class="fa-solid fa-moon"> </i> @reserva.Noites.GetValueOrDefault(1).ToString() Noite(s)
                        <i class="fa fa-users" aria-hidden="true"></i> @reserva.Hospedes.GetValueOrDefault(1).ToString() Hospede(s)
                    </MudText>
                    <MudSpacer />
                    <MudText Align="Align.Center" Class="mb-n4"> - </MudText>
                    <MudText Align="Align.Center"> Nome do Hospede Principal: @reserva.NomeHospede  </MudText>
                    <MudText Align="Align.Center"> Origem: @reserva.Origem  </MudText>
                    @if (!string.IsNullOrEmpty(reserva.IDReservaAgencia))
                    {
                        <MudText Align="Align.Center"> Número da reserva via agência: @reserva.IDReservaAgencia  </MudText>
                    }
                    <MudSpacer />
                    <br />
                    @if (reserva is not null && reserva.ListaQuartos is not null && reserva.ListaQuartos.Count > 0)
                    {
                        <MudPaper Class="rounded-xl">
                            <MudExpansionPanel Dense="true" DisableGutters="true" Text="Acomodações" style="background-color: #F5F4F4;">
                                <MudDivider />
                                <MudPaper class="rounded-b-xl">
                                    @foreach (var item in reserva.ListaQuartos)
                                    {
                                        <MudListItem>
                                            <MudText Typo="Typo.caption">@item.Descricao</MudText>
                                        </MudListItem>
                                    }
                                </MudPaper>
                            </MudExpansionPanel>
                        </MudPaper>
                    }
                    <br />
                    <MudSpacer />
                    @if (reserva is not null && (reserva.BalanceDetailed!.GrandTotal - reserva.BalanceDetailed!.Paid) > 0)
                    {
                        <MudPaper Class="rounded-xl">
                            <MudListItem style="background-color: #F5F4F4;" class="rounded-t-xl">
                                <MudStack Row="true">
                                    <MudText><b>Instruções para a transferência bancária - PIX</b></MudText>
                                    <MudSpacer />
                                    <MudIcon Icon="fa-solid fa-building-columns" Title="Favorite" />
                                </MudStack>
                            </MudListItem>
                            <MudDivider />
                            <MudListItem>
                                <MudText Typo="Typo.caption">NÃO E POSSÍVEL PAGAR NO CHECK-IN !!!</MudText><br />
                                <MudText Typo="Typo.caption" GutterBottom="true" Class="ml-auto">
                                    Reservas não paga no período de  20 minutos sera cancelada, como nossos Termos e Politicas.<br />
                                    Pix nossa chave CNPJ 35.337.342/0001-86<br />
                                    Nome JOSE CARLOS NOBRE<br />
                                    Banco SICOOB<br />
                                    Reservas também sem CPF serão canceladas.
                                </MudText>
                            </MudListItem>
                        </MudPaper>
                    }
                </MudPaper>
            </MudItem>
            <MudItem xs="12" sm="3">
                <MudGrid>
                    <MudItem xs="12">
                        <MudPaper Elevation="2" Class="pa-4 align-items-center rounded-xl" Style="height: 100%">
                            <MudText Typo="Typo.h5" Align="Align.Center">Cobrança</MudText>
                            <MudList Clickable="false" Dense="true">
                                <MudDivider />
                                <MudListItem>
                                    <div class="d-flex">
                                        <MudText Typo="Typo.caption">Acomodações</MudText>
                                        <MudText Typo="Typo.caption" GutterBottom="true" Class="ml-auto">R$ @reserva.BalanceDetailed!.SubTotal.ToString("N2", new CultureInfo("pt-BR"))</MudText>
                                    </div>
                                </MudListItem>
                                <MudListItem>
                                    <div class="d-flex">
                                        <MudText Typo="Typo.caption">Itens adicionais e extras</MudText>
                                        <MudText Typo="Typo.caption" GutterBottom="true" Class="ml-auto">R$ @reserva.BalanceDetailed!.AdditionalItems.ToString("N2", new CultureInfo("pt-BR"))</MudText>
                                    </div>
                                </MudListItem>
                                <MudListItem>
                                    <div class="d-flex">
                                        <MudText Typo="Typo.caption">Imposto e taxas</MudText>
                                        <MudText Typo="Typo.caption" GutterBottom="true" Class="ml-auto">R$ @reserva.BalanceDetailed!.TaxesFees.ToString("N2", new CultureInfo("pt-BR"))</MudText>
                                    </div>
                                </MudListItem>
                                <MudDivider />
                                <MudListItem>
                                    <div class="d-flex">
                                        <MudText Typo="Typo.caption" GutterBottom="true"><b>Total</b></MudText>
                                        <MudText Typo="Typo.caption" GutterBottom="true" Class="ml-auto"><b>R$ @reserva.BalanceDetailed!.GrandTotal.ToString("N2", new CultureInfo("pt-BR"))</b></MudText>
                                    </div>
                                </MudListItem>
                                <MudListItem>
                                    <div class="d-flex">
                                        <MudText Typo="Typo.caption" GutterBottom="true"><b>Valor pago</b></MudText>
                                        <MudText Typo="Typo.caption" GutterBottom="true" Class="ml-auto"><b>R$ @reserva.BalanceDetailed!.Paid.ToString("N2", new CultureInfo("pt-BR"))</b></MudText>
                                    </div>
                                </MudListItem>
                            </MudList>
                            <div class="mt-auto">
                                <MudDivider />
                                <div class="d-flex pa-4">
                                    <MudText><b>Saldo a pagar</b></MudText>
                                    <MudText Class="ml-auto"><b>R$ @((reserva.BalanceDetailed!.GrandTotal - reserva.BalanceDetailed!.Paid).ToString("N2", new CultureInfo("pt-BR")))</b></MudText>
                                </div>
                            </div>
                        </MudPaper>
                    </MudItem>
                </MudGrid>
            </MudItem>
        </MudGrid>
    </MudContainer>
}



@code {
    [Parameter]
    public string ReservationId { get; set; }

    public Reserva reserva { get; set; }

    bool ReadOnly = true;
    bool NestedReadOnly;
    bool Disabled = true;
    bool NestedDisabled;

    protected override async Task OnInitializedAsync()
    {
        reserva = await cloudbedsAPI.GetReservaAsync(ReservationId);
    }
} 